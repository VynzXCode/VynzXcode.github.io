<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protected Content</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .safe-container {
            position: relative;
            z-index: 1;
            padding: 20px;
        }

        .content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Protection layers */
        .protection-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 2147483646;
        }

        .protection-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 2147483646;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        #protectionOverlay {
            position: fixed;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: #000;
            z-index: 2147483647;
            display: none;
            pointer-events: none;
            transform: translateZ(0);
            will-change: transform;
            transition: none;
        }

        .screenshot-protected {
            position: relative;
        }

        .screenshot-protected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 2147483645;
        }

        @media print {
            body * {
                visibility: hidden !important;
            }
            #protectionOverlay {
                visibility: visible !important;
                display: block !important;
            }
        }
    </style>
</head>
<body class="screenshot-protected">
    <div class="protection-wrapper">
        <div class="protection-layer"></div>
        <div class="protection-layer"></div>
        <div class="protection-layer"></div>
    </div>

    <div class="safe-container">
        <div class="content">
            <h1>Contoh Konten Website</h1>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
    </div>

    <div id="protectionOverlay"></div>

    <script>
        class AdvancedScreenshotProtection {
            constructor() {
                this.overlay = document.getElementById('protectionOverlay');
                this.isProtecting = false;
                this.protectionTimeout = null;
                this.monitoringInterval = null;
                this.setupProtection();
                this.startConstantMonitoring();
            }

            activateProtection() {
                if (!this.isProtecting) {
                    this.isProtecting = true;
                    this.overlay.style.display = 'block';
                    
                    // Rapidly toggle overlay untuk memastikan tertangkap
                    let toggleCount = 0;
                    const rapidToggle = setInterval(() => {
                        this.overlay.style.display = toggleCount % 2 === 0 ? 'none' : 'block';
                        toggleCount++;
                        if (toggleCount > 10) clearInterval(rapidToggle);
                    }, 16);

                    // Clear protection setelah 1 detik
                    clearTimeout(this.protectionTimeout);
                    this.protectionTimeout = setTimeout(() => {
                        this.deactivateProtection();
                    }, 1000);
                }
            }

            deactivateProtection() {
                this.isProtecting = false;
                this.overlay.style.display = 'none';
            }

            startConstantMonitoring() {
                if (this.monitoringInterval) clearInterval(this.monitoringInterval);

                // Monitor setiap 16ms (60fps)
                this.monitoringInterval = setInterval(() => {
                    if (this.shouldActivateProtection()) {
                        this.activateProtection();
                    }
                }, 16);
            }

            shouldActivateProtection() {
                // Deteksi berbagai kondisi yang mungkin mengindikasikan screenshot
                const conditions = [
                    document.hidden,
                    document.msHidden,
                    document.webkitHidden,
                    window.outerWidth - window.innerWidth > 200,
                    window.outerHeight - window.innerHeight > 200,
                    document.visibilityState === 'hidden'
                ];

                return conditions.some(condition => condition);
            }

            setupProtection() {
                // Screenshot detection
                const events = [
                    'keydown', 'keyup', 'visibilitychange',
                    'webkitvisibilitychange', 'mozvisibilitychange',
                    'focus', 'blur', 'resize', 'contextmenu',
                    'touchstart', 'touchend'
                ];

                events.forEach(event => {
                    document.addEventListener(event, (e) => {
                        // Prevent default for certain events
                        if (['contextmenu', 'selectstart', 'copy'].includes(e.type)) {
                            e.preventDefault();
                        }

                        // Screenshot detection logic
                        if (
                            (e.type === 'keydown' && (
                                e.key === 'PrintScreen' ||
                                e.code === 'PrintScreen' ||
                                (e.ctrlKey && e.shift && e.key === 'S') ||
                                (e.metaKey && e.shift && (e.key === '3' || e.key === '4'))
                            )) ||
                            (e.type === 'visibilitychange' && document.hidden) ||
                            (e.type === 'touchstart' && e.touches.length >= 2)
                        ) {
                            this.activateProtection();
                        }
                    }, true);
                });

                // Prevent various capture methods
                document.addEventListener('keydown', e => {
                    if (e.ctrlKey || e.metaKey) {
                        if (['s', 'p', 'c', 'x', 'u', 'i'].includes(e.key.toLowerCase())) {
                            e.preventDefault();
                        }
                    }
                });

                // Mobile-specific detection
                if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    let lastVolume = null;
                    let volumeTimeout;

                    // Volume button detection
                    window.addEventListener('volumechange', () => {
                        const now = Date.now();
                        if (lastVolume && now - lastVolume < 500) {
                            this.activateProtection();
                        }
                        lastVolume = now;
                        
                        clearTimeout(volumeTimeout);
                        volumeTimeout = setTimeout(() => {
                            lastVolume = null;
                        }, 500);
                    });
                }

                // MutationObserver untuk mendeteksi perubahan DOM
                const observer = new MutationObserver(() => {
                    if (this.shouldActivateProtection()) {
                        this.activateProtection();
                    }
                });

                observer.observe(document.body, {
                    childList: true,
                    subtree: true,
                    attributes: true
                });
            }
        }

        // Initialize protection
        document.addEventListener('DOMContentLoaded', () => {
            window.screenshotProtection = new AdvancedScreenshotProtection();
        });

        // Tambahan untuk memastikan protection tetap aktif
        setInterval(() => {
            if (window.screenshotProtection) {
                window.screenshotProtection.startConstantMonitoring();
            }
        }, 100);
    </script>
</body>
</html>
